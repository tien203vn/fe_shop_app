<div class="container">

  <div class="card">
    <div class="card-body">
      <h4 class="card-title">Cập nhật sản phẩm</h4>

      <!-- Multi Columns Form -->
      <form class="row g-3" (ngSubmit)="updateProduct()">
        <div class="col-md-6">
          <label for="name" class="form-label">Tên sản phẩm<span style="color: red;"> (*)</span></label>
          <input type="text" id="name" [(ngModel)]="updatedProduct.name" name="name" class="form-control" required>
        </div>
        <div class="col-md-6">
          <label for="price" class="form-label">Giá<span style="color: red;"> (*)</span></label>
          <input type="number" id="price" [(ngModel)]="updatedProduct.price" name="price" class="form-control"
            required>
        </div>
        <div class="col-md-6">
          <label for="stock" class="form-label">Số lượng tồn<span style="color: red;"> (*)</span></label>
          <input type="number" id="stock" [(ngModel)]="updatedProduct.stock" name="stock" class="form-control" required min="0">
        </div>
        <div class="col-md-12 mt-3">
          <label for="description" class="form-label">Nội dung<span style="color: red;"> (*)</span></label>
          <textarea id="description" [(ngModel)]="updatedProduct.description" name="description" class="form-control"
            required></textarea>
        </div>
        
        <div class="row mb-3">
          <div class="thumbnail-container">
            <ng-container *ngIf="product && product.product_images && product.product_images.length > 0; else noImages">
              <div *ngFor="let productImage of product.product_images; let i = index; trackBy: trackByImage"
                   class="thumbnail-item" 
                   [class.active]="i === currentImageIndex">
                <img [src]="productImage.image_url || 'assets/images/placeholder.jpg'" 
                     class="thumbnail-image" 
                     alt="Product Image"
                     (error)="productImage.image_url = 'assets/images/placeholder.jpg'">
                <button type="button" 
                        class="btn btn-sm remove-image" 
                        (click)="$event.stopPropagation(); deleteImage(productImage)"
                        title="Xóa ảnh">
                  <i class="fa fa-times-circle text-danger"></i>
                </button>
              </div>
            </ng-container>
            <ng-template #noImages>
              <div class="no-images">
                <i class="fas fa-image"></i>
                <p>Chưa có ảnh sản phẩm</p>
              </div>
            </ng-template>
          </div>
        </div>
        <div class="col-md-6">
          <label for="category_id" class="form-label">Thể loại<span class="text-danger"> (*)</span></label>
          <select id="category_id" 
                  [(ngModel)]="selectedCategoryId" 
                  (change)="onCategoryChange($event)"
                  name="category_id" 
                  class="form-select" 
                  required>
            <option [ngValue]="null" disabled>Chọn thể loại</option>
            <option *ngFor="let category of categories" 
                    [ngValue]="category.id"
                    [selected]="category.id === selectedCategoryId">
              {{ category.name }}
            </option>
          </select>
          @if (selectedCategoryId) {
            <div class="mt-2 text-muted small">
              Đã chọn: 
              @if (categories && categories.length > 0) {
                @for (category of categories; track category.id) {
                  @if (category.id === selectedCategoryId) {
                    <span class="fw-medium">{{ category.name }}</span>
                    <span class="text-muted ms-2">(ID: {{ category.id }})</span>
                  }
                }
              } @else {
                <span>ID: {{ selectedCategoryId }}</span>
              }
            </div>
          }
        </div>
        <div class="col-12">
          <label for="images" class="form-label">Chọn ảnh (Tối đa 3 ảnh)</label>
          <input type="file" 
                 id="images" 
                 class="form-control" 
                 name="images" 
                 multiple 
                 (change)="onFileChange($event)" 
                 accept="image/*"
                 style="margin-bottom: 1rem;">
        </div>

        <div class="col-12 text-end">
          <button type="submit" class="btn btn-primary me-2">
            <i class="fas fa-save me-1"></i> Lưu thay đổi
          </button>
          <button type="button" class="btn btn-outline-secondary" routerLink="/admin/products">
            <i class="fas fa-arrow-left me-1"></i> Quay lại
          </button>
        </div>
      </form>
    </div>
  </div>
</div>